---
- name: os-specific tasks
  include_tasks: "{{ item }}"
  with_first_found:
    - files:
        - >-
          {{ ansible_distribution }}-{{ ansible_distribution_major_version }}.yml
        - >-
          {{ ansible_distribution }}.yml
        - >-
          {{ ansible_os_family }}-{{  ansible_distribution_major_version }}.yml
        - >-
          {{ ansible_os_family }}.yml
      skip: true

- name: install
  package:
    name: fish
  become: >-
    {% if ansible_os_family == 'Darwin' %}no{% else %}yes{% endif %}

- name: create config dir
  file:
    path: "{{ ansible_user_dir }}/.config/fish/functions"
    mode: "0755"
    state: directory

- name: configure fish
  template:
    src: templates/config.fish.j2
    mode: "0644"
    dest: "{{ __fish_directory }}/config.fish"

- name: creating functions
  template:
    src: templates/fish_function.j2
    mode: "0644"
    dest: "{{ __fish_directory }}/functions/{{ item.name }}.fish"
  with_items: "{{ fish_functions }}"
